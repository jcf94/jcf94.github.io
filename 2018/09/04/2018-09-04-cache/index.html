<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">

  <link rel="search" type="application/opensearchdescription+xml" href="https://jcf94.com/sitesearch.xml" title="Chenfan Blog">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-big-counter.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jcf94.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="可能是因为简历里面写了个大大的 “计算机系统结构方向”，然后面的几个厂的岗位也都是偏系统方向，秋招面试的时候被好几个面试官都按在地上狂问系统方面的问题。 其中大概尤其与 Cache 有关的内容比较有代表性，于是准备根据几次回忆出来的自己和小伙伴遇到的面试题好好理一理 Cache 这块的内容。">
<meta property="og:type" content="article">
<meta property="og:title" content="（试图）深入理解 Cache">
<meta property="og:url" content="https://jcf94.com/2018/09/04/2018-09-04-cache/index.html">
<meta property="og:site_name" content="Chenfan Blog">
<meta property="og:description" content="可能是因为简历里面写了个大大的 “计算机系统结构方向”，然后面的几个厂的岗位也都是偏系统方向，秋招面试的时候被好几个面试官都按在地上狂问系统方面的问题。 其中大概尤其与 Cache 有关的内容比较有代表性，于是准备根据几次回忆出来的自己和小伙伴遇到的面试题好好理一理 Cache 这块的内容。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://jcf94.com/download/2018-09-04-cache-hierarchy.png">
<meta property="og:image" content="http://jcf94.com/download/2018-09-04-cache-location.jpg">
<meta property="og:image" content="http://jcf94.com/download/2018-09-04-cache-8-way.png">
<meta property="og:image" content="http://jcf94.com/download/2018-09-04-cache-cam.png">
<meta property="og:image" content="http://jcf94.com/download/2018-09-04-cache-sbtfalse_sharing.PNG">
<meta property="article:published_time" content="2018-09-04T06:11:47.000Z">
<meta property="article:modified_time" content="2018-10-04T02:46:34.000Z">
<meta property="article:author" content="Jcf94">
<meta property="article:tag" content="Cache">
<meta property="article:tag" content="面试">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://jcf94.com/download/2018-09-04-cache-hierarchy.png">

<link rel="canonical" href="https://jcf94.com/2018/09/04/2018-09-04-cache/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>（试图）深入理解 Cache | Chenfan Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Chenfan Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Chenfan Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Do cool things that matter.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-paper-reading">

    <a href="/2017/08/18/2017-08-18-paper/" rel="section"><i class="fa fa-fw fa-bookmark"></i>Paper Reading</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-fw fa-link"></i>Links</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jcf94.com/2018/09/04/2018-09-04-cache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/photo.jpg">
      <meta itemprop="name" content="Jcf94">
      <meta itemprop="description" content="To live is to change the world.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chenfan Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          （试图）深入理解 Cache
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-04 14:11:47" itemprop="dateCreated datePublished" datetime="2018-09-04T14:11:47+08:00">2018-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-10-04 10:46:34" itemprop="dateModified" datetime="2018-10-04T10:46:34+08:00">2018-10-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer-Architecture/" itemprop="url" rel="index"><span itemprop="name">Computer Architecture</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>可能是因为简历里面写了个大大的 “计算机系统结构方向”，然后面的几个厂的岗位也都是偏系统方向，秋招面试的时候被好几个面试官都<strong>按在地上</strong>狂问系统方面的问题。</p>
<p>其中大概尤其与 Cache 有关的内容比较有代表性，于是准备根据几次回忆出来的自己和小伙伴遇到的面试题好好理一理 Cache 这块的内容。</p>
<p><img data-src="http://jcf94.com/download/2018-09-04-cache-hierarchy.png" alt="Hierarchy"></p>
<a id="more"></a>

<h1 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h1><p>上图是一张最基础也最常见的存储器层次结构图，表达的是计算机系统中各级存储器的速度、容量、价格等等的金字塔关系。</p>
<p>Cache 这个思想本身特别简单，利用的核心原理就是数据的<strong>局部性</strong>，即<strong>把最常用到的东西放在最容易拿到的地方</strong>，这种局部性<strong>即包含了数据的空间局部性也包含了使用数据的时间局部性</strong>，但实际用起来效果却是非常地好，并且广泛应用在各种不同的场合中，例如：CPU 中的 Cache 用来加速对主存数据的访问，TLB 可以看成是对虚拟地址-物理地址转换的页表的 Cache，分布式环境中有的时候也会做个本地数据缓存，也是 Cache 的思想。</p>
<p>其实《硬软件接口》里面已经有介绍过 Cache 了，前面也有记过：</p>
<ul>
<li><a href="http://jcf94.com/2018/02/06/2018-02-06-cod2/#CHAPTER-5-Large-and-Fast-Exploiting-Memory-Hierarchy">【计算机组成与设计.硬件/软件接口 学习笔记（二）：CHAPTER 5. Large and Fast: Exploiting Memory Hierarchy】</a></li>
<li><a href="http://jcf94.com/2015/10/23/2015-10-23-virtualmemory/">【硬件/软件接口 Virtual Memory】</a></li>
</ul>
<p>编程的时候 Cache 对程序员透明，写代码的人直接看到的是内存（……更准确地说看到的是虚拟的地址空间），但是 CPU 实际执行的时候访问的数据全部都是从 Cache 里面来的。每次访问一块新的内存数据时，首先检查 Cache 中是否存在，有就返回，没有就触发一次 Cache Miss，从主存把数据 load 到 Cache 中以后再返回。</p>
<p>然而 Cache 这个简单的想法在实际实现的时候可能会复杂的多，例如 Cache 分级，然后 Cache 还有多种数据和地址的映射关系，什么时候更新写回，地址冲突的时候怎么替换等等很多麻烦的问题都需要在实际实现的时候考虑。</p>
<p>这里还有两篇知乎上的小白科普文：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/31422201" target="_blank" rel="noopener">【L1，L2，L3 Cache究竟在哪里？】</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/31859105" target="_blank" rel="noopener">【Cache是怎么组织和工作的？】</a></li>
</ul>
<h1 id="Interview-Questions"><a href="#Interview-Questions" class="headerlink" title="Interview Questions"></a>Interview Questions</h1><p>面试的时候我和我的小伙伴们在 Cache 上踩了很多坑，虽然平时工作中很少有遇到需要考虑的这么深的，也就一般很少想到 Cache 这一层的工作内容了，但是终究说起来还是自己的基础没打扎实。</p>
<h2 id="虚拟地址-or-物理地址？"><a href="#虚拟地址-or-物理地址？" class="headerlink" title="虚拟地址 or 物理地址？"></a>虚拟地址 or 物理地址？</h2><blockquote>
<p>L1 Cache 标记数据块用的是虚拟地址还是物理地址？</p>
</blockquote>
<p>往后的 Cache 里面肯定用的是物理地址，这个没有任何悬念，关键在这个最靠近 CPU 的 L1 Cache 上。</p>
<p>这个问题一开始我脑子里冒出来的是当时看《硬软件接口》虚拟内存那章时画的<a href="http://jcf94.com/2015/10/23/2015-10-23-virtualmemory/">那张图</a>：CPU 先拿虚拟地址去查 TLB，然后再找 Cache，那妥妥的就是物理地址了。</p>
<p>后来一想这本书上是以一个假想的简单数据通路结构为例进行介绍，可能细节上后来有变动，然后去翻了下《量化》，里面没有详细讲，但是看图感觉像是用的虚拟地址。</p>
<p>再后来去网上搜这个问题的时候，说物理地址的也有，说虚拟地址的也有，还各有各的理由，于是就更迷了。</p>
<p>直到我在<a href="https://zhuanlan.zhihu.com/p/31875174" target="_blank" rel="noopener">这个专栏文章中</a>看到了这张图：</p>
<p><img data-src="http://jcf94.com/download/2018-09-04-cache-location.jpg" alt="Cache 与 MMU 的位置关系"></p>
<p>MMU 是 CPU 中用于虚拟地址-物理地址转换的工作单元（主要是页表、TLB 甚至多级 TLB 等等组成），这张图中根据芯片实际实现时 MMU 和 Cache 的位置关系，则很明显 L1 Cache 可能用虚拟地址也可能用物理地址了。</p>
<p>那我们来考虑一下这两种实现的区别：</p>
<ul>
<li><p>Logical Cache/ Virtual Cache</p>
<p>感觉这种实现访问速度应该更快一点，因为不需要经过地址翻译就能够直接在 Cache 中搜索数据了。</p>
<p>问题是每个进程的虚拟地址空间都是独立的，如果有多个进程在同一个核上切换，则每次切换的时候都需要把 Cache 刷掉（话说我其实不太清楚这个代价会有多大，也不知道这个会不会成为制约性能的一个原因），当然，也有可能有多个虚拟地址对应到同一个物理地址上的这种情况，那这种情况要怎么处理就需要考虑更多东西了。</p>
<p>……真麻烦啊。</p>
</li>
<li><p>Physical Cache</p>
<p>查 Cache 前不管怎么样先把地址转换做了，这样前面 Logical Cache 存在的问题也就不存在了，而且也不需要一切换进程就刷一遍整个 L1 Cache，如果有多个虚拟地址对应到同一个物理地址上也无所谓。</p>
<p>问题大概就在于 MMU 的地址转换上，如果 TLB Miss 了，查页表还是要访问到主存上，那再查 Cache 就需要花更多的时间了。</p>
</li>
</ul>
<hr>
<p><a href="https://www.wikiwand.com/en/CPU_cache#/Address_translation" target="_blank" rel="noopener">CPU_cache 的维基百科页</a>对地址转换这块也有大段篇幅的介绍。Cache 受地址转换影响在 Latency、Aliasing、Granularity 等几个方面都需要考虑到，根据用虚拟地址还是物理地址进行查找和标记，常见的也有下面四种 Cache 实现方式：</p>
<ol>
<li><p>Physically Indexed, Physically Tagged(PIPT)</p>
<p>对应前面的 Physical Cache，没啥大毛病，就是慢</p>
</li>
<li><p>Virtually Indexed, Virtually Tagged(VIVT)</p>
<p>对应前面的 Logical Cache/ Virtual Cache，带来的麻烦问题很多</p>
</li>
<li><p>Virtually Indexed, Physically Tagged(VIPT)</p>
<p>可能是最好的一种实现方式了，目前市场上的一些现代处理器应该大多都是基于这种方式或者在这个基础上优化的。</p>
<p>由于查虚拟地址的索引和查 TLB 可以同时进行，这种方式的延迟会比 PIPT 低很多，但是实际数据还是要等到 MMU 把物理地址算出来之后对比 tag 才能确定。</p>
<p>另一方面由于用了物理地址作为 tag，VIVT 中可能会有的虚拟地址冲突的问题也解决了。</p>
</li>
<li><p>Physically Indexed, Virtually Tagged(PIVT)</p>
<p>这个…大概只会出现在文献中，实际实现的时候会集合 PIPT 和 VIVT 所有的缺点。</p>
</li>
</ol>
<p>另外，对 Cache 数据的查找和标记还需要考虑到全相联、组相联等不同的映射关系的实现。</p>
<h2 id="对-Cache-每一级的访存需要多少个-Cycle-有概念吗？"><a href="#对-Cache-每一级的访存需要多少个-Cycle-有概念吗？" class="headerlink" title="对 Cache 每一级的访存需要多少个 Cycle 有概念吗？"></a>对 Cache 每一级的访存需要多少个 Cycle 有概念吗？</h2><blockquote>
<p>对 Context Switch 和 Cache 访存需要大概花费多少个 Cycle 有概念吗？</p>
</blockquote>
<p>并没有……卒。</p>
<hr>
<p>看一下网上找到的答案：</p>
<ul>
<li>Register：1 Cycle</li>
<li>L1 Cache：3 Cycles</li>
<li>L2 Cache：10+ Cycles</li>
<li>L3 Cache：20~30+ Cycles</li>
<li>Main Memory：~100 Cycles</li>
</ul>
<p>同样都是用 SRAM 做的，为什么会有速度差异呢？原因大概有以下几个：</p>
<ol>
<li><p>容量大小</p>
<p>显而易见的是，Cache 的容量会随着级数的增加而增大。由于 Cache 需要做到随机访存，即能够直接访问到存储器的任意一个位置，在制程和设计完全一致的情况下，容量越大就需要花费更多的时间来做到随机访存（延迟跟容量的开方大致成正比）。</p>
</li>
<li><p>芯片上与 CPU 的距离</p>
<p>在芯片面积有限的情况下，L1 Cache 会被放置在离 CPU 核心非常近的地方，而 L2 Cache 就只能放到边缘位置了。</p>
<p>L1 中的指令 Cache 会在 Fetch 单元附近，数据 Cache 会在 Load/ Store 单元附近，L2 Cache 就要在 CPU 流水线外面了，L3 更远要在核外了。</p>
</li>
<li><p>具体实现的差异</p>
<p>L1 和 L2 在设计时的侧重点会有所区别，L1 更注重速度，而 L2 要在 L1 Miss 之后才发挥作用，因此更注重节能和容量。</p>
<p>查询一个地址时，L1 Cache 会把多个 Cache Line 的 tag 和数据全部取出来，然后再比较 tag 看哪一个命中或者都没命中。</p>
<p>而 L2 Cache 虽然也是 N 路组相联，但是比较时会先取 tag，当找到命中的之后再去把对应的数据取出来。</p>
<p>L3 做在核外，通常是多个核共享，因此还需要额外考虑一致性等等更多的东西。</p>
</li>
</ol>
<hr>
<p>关于 Context Switch 这点，进程和线程的切换其实都要涉及到上下文的切换。</p>
<p>进程切换时由于虚拟地址空间不同，因此需要切换页面映射、刷新 TLB 等等，如果是线程切换则开销会小很多。</p>
<h2 id="为什么需要分级？"><a href="#为什么需要分级？" class="headerlink" title="为什么需要分级？"></a>为什么需要分级？</h2><p>这个问题直接有别人解答了，感觉说的也还算清楚：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/32058808" target="_blank" rel="noopener">【Cache为什么有那么多级？为什么一级比一级大？是不是Cache越大越好？】</a></li>
</ul>
<h2 id="组成结构？"><a href="#组成结构？" class="headerlink" title="组成结构？"></a>组成结构？</h2><p>当时被问到这个问题的时候有点懵逼，不确定面试官想表达的是什么意思，我回答 “Index、tag、cache line data” 的时候被否决了……然后后来就没有答上来了。</p>
<p>如果指的不是全相联、组相联这种实现的话，可能想问的是硬件实现？</p>
<p>我对 Cache 硬件结构的了解就只是知道它是用 SRAM 做的，其他的就不懂了，卒。</p>
<hr>
<p>这一块能够找到的资料也比较模糊，最后是从<a href="https://1drv.ms/b/s!AuxK9QzqA6LQkvZxNVaponZFKqF6uA" target="_blank" rel="noopener">王齐的《浅谈 Cache Memory》</a>中找到了比较靠谱的答案：</p>
<p>组相联方式组织的 Cache 会分成两个部分，Tag 部分和数据部分分开存放，例如一个 8 路组相联的 Cache 结构是这样的：</p>
<p><img data-src="http://jcf94.com/download/2018-09-04-cache-8-way.png" alt="8-Way Set-Associative"></p>
<p>左边是地址 Tag 以及当前 Cache Line 的状态，右边是实际存放的数据。</p>
<p>这两类字段由于功能和特性不同，会使用两种不同类型的存储器来存放。Tag 阵列多使用 <strong>CAM（Content Addressable Memory）</strong>来存放，以利于并行查找，数据字段用的才是<strong>多端口多 Bank 的 SRAM</strong>。一般说的 Cache 大小也都指的是 SRAM 数据块的大小，CAM 这部分不包含在内。</p>
<p>CAM 对应的应该是前面结构图中一个 Set 中的多个 Way 的结构。首先根据需要访问的虚拟地址确定 Index 找到在哪个 Set 中，然后对该 Set 中的多条记录并行进行 Tag 的比对。</p>
<p>CAM 的基本结构如下：</p>
<p><img data-src="http://jcf94.com/download/2018-09-04-cache-cam.png" alt="CAM 的基本组成结构"></p>
<p>上图的 CAM 有 3 个 Word，分别对应一条横向的 ML（Match Line），每一个 Word 由 4 个 Bits （CAM Cell）组成。在每一列中，Bits 分别与两个 SL（Search Line）对应。</p>
<p>使用 CAM 进行查找时，首先需要把需要搜索的目标（Tag）放入 Search Data Register/Drivers 中，分解成多个 Bits 之后，通过 SL 发送到所有的 CAM Cell 中，每个 Cell 的 Hit/Miss 信息会向右传递给各自的 ML，最终 ML 汇总得到自己的 Hit/Miss 情况，这样就能够确定下来在当前的多个 Way 里面有没有命中的数据了。</p>
<p>后面更细节的就跳过了。</p>
<h2 id="如何测出一块未知-CPU-的-Cache-参数？"><a href="#如何测出一块未知-CPU-的-Cache-参数？" class="headerlink" title="如何测出一块未知 CPU 的 Cache 参数？"></a>如何测出一块未知 CPU 的 Cache 参数？</h2><blockquote>
<p>假如你是一个 Intel 的工程师，有一天你的竞争对手 AMD 推出了一款新的 CPU，然后你想要知道关于其中的 Cache 的信息，要怎么做？没有其他任何的资料，只能通过实际测试的方式。</p>
</blockquote>
<p>这个问题是紧接着上一个的，由于我被问到上一个问题的时候已经懵逼了，这题基本上完全没答上来，其实后来想想应该至少能把 Cache 的大小测出来，当时回答的时候真的是表现得太差了。</p>
<hr>
<p>参考：</p>
<ul>
<li><a href="https://blog.csdn.net/GVFDBDF/article/details/49817979" target="_blank" rel="noopener">【cache测试及其矩阵优化】</a></li>
<li><a href="http://igoro.com/archive/gallery-of-processor-cache-effects/" target="_blank" rel="noopener">【Gallery of Processor Cache Effects】</a></li>
</ul>
<p>根据第一篇的程序稍微改了一下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ***********************************************</span></span><br><span class="line"><span class="comment">MYID	: Chen Fan</span></span><br><span class="line"><span class="comment">LANG	: G++</span></span><br><span class="line"><span class="comment">PROG	: </span></span><br><span class="line"><span class="comment">************************************************ */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> KB (1024/4)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MB (1024 * KB)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE (128 * MB)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getTime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line">    gettimeofday(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//获取秒</span></span><br><span class="line">    <span class="keyword">double</span> sec = (<span class="keyword">double</span>)tv.tv_sec;</span><br><span class="line">    <span class="comment">//获取微秒</span></span><br><span class="line">    <span class="keyword">double</span> usec = (<span class="keyword">double</span>)tv.tv_usec;</span><br><span class="line">    <span class="comment">//返回微秒数</span></span><br><span class="line">    <span class="keyword">return</span> sec * <span class="number">1000000</span> + usec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cache_line_test</span><span class="params">(<span class="keyword">int</span> *<span class="built_in">array</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> stride=<span class="number">1</span>;stride&lt;<span class="number">64</span>*KB;stride*=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">double</span> begin_time = getTime();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;SIZE;i+=stride)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">array</span>[i] *= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> end_time = getTime();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Stride: %5d,  Line Size: %5d Bytes,  Average Cost: %10lf us\n"</span>, stride, stride*<span class="number">4</span>, (end_time - begin_time) / (SIZE/stride));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cache_block_test</span><span class="params">(<span class="keyword">int</span> *<span class="built_in">array</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num=KB;num&lt;MB;num*=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> len = num<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> tot = SIZE<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">double</span> begin_time = getTime();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tot;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">array</span>[(i*<span class="number">16</span>) &amp; len] *= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> end_time = getTime();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Num: %8d,  Size: %8d KB,  cost %10lf us\n"</span>, num, num*<span class="number">4</span>/<span class="number">1024</span>, end_time - begin_time);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num=MB;num&lt;<span class="number">16</span>*MB;num+=MB)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> len = num<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> tot = SIZE<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">double</span> begin_time = getTime();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tot;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">array</span>[(i*<span class="number">16</span>) &amp; len] *= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span> end_time = getTime();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Num: %8d,  Size: %8d MB,  cost %10lf us\n"</span>, num, num*<span class="number">4</span>/<span class="number">1024</span>/<span class="number">1024</span>, end_time - begin_time);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *<span class="built_in">array</span> = <span class="keyword">new</span> <span class="keyword">int</span>[SIZE];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;SIZE;i++) <span class="built_in">array</span>[i] = i;</span><br><span class="line"></span><br><span class="line">    cache_line_test(<span class="built_in">array</span>);</span><br><span class="line">    cache_block_test(<span class="built_in">array</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Stride:     1,  Line Size:     4 Bytes,  Average Cost:   0.002586 us</span><br><span class="line">Stride:     2,  Line Size:     8 Bytes,  Average Cost:   0.002613 us</span><br><span class="line">Stride:     4,  Line Size:    16 Bytes,  Average Cost:   0.002622 us</span><br><span class="line">Stride:     8,  Line Size:    32 Bytes,  Average Cost:   0.003078 us</span><br><span class="line">Stride:    16,  Line Size:    64 Bytes,  Average Cost:   0.004280 us</span><br><span class="line">Stride:    32,  Line Size:   128 Bytes,  Average Cost:   0.011414 us</span><br><span class="line">Stride:    64,  Line Size:   256 Bytes,  Average Cost:   0.011412 us</span><br><span class="line">Stride:   128,  Line Size:   512 Bytes,  Average Cost:   0.007610 us</span><br><span class="line">Stride:   256,  Line Size:  1024 Bytes,  Average Cost:   0.015221 us</span><br><span class="line">Stride:   512,  Line Size:  2048 Bytes,  Average Cost:   0.015732 us</span><br><span class="line">Stride:  1024,  Line Size:  4096 Bytes,  Average Cost:   0.000000 us</span><br><span class="line">Stride:  2048,  Line Size:  8192 Bytes,  Average Cost:   0.000000 us</span><br><span class="line">Stride:  4096,  Line Size: 16384 Bytes,  Average Cost:   0.000000 us</span><br><span class="line">Stride:  8192,  Line Size: 32768 Bytes,  Average Cost:   0.000000 us</span><br><span class="line">Num:      256,  Size:        1 KB,  cost 86789.000000 us</span><br><span class="line">Num:      512,  Size:        2 KB,  cost 88739.000000 us</span><br><span class="line">Num:     1024,  Size:        4 KB,  cost 86736.000000 us</span><br><span class="line">Num:     2048,  Size:        8 KB,  cost 91756.000000 us</span><br><span class="line">Num:     4096,  Size:       16 KB,  cost 88762.000000 us</span><br><span class="line">Num:     8192,  Size:       32 KB,  cost 94745.000000 us</span><br><span class="line">Num:    16384,  Size:       64 KB,  cost 95744.000000 us</span><br><span class="line">Num:    32768,  Size:      128 KB,  cost 105752.000000 us</span><br><span class="line">Num:    65536,  Size:      256 KB,  cost 105684.000000 us</span><br><span class="line">Num:   131072,  Size:      512 KB,  cost 108742.000000 us</span><br><span class="line">Num:   262144,  Size:        1 MB,  cost 99733.000000 us</span><br><span class="line">Num:   524288,  Size:        2 MB,  cost 114694.000000 us</span><br><span class="line">Num:   786432,  Size:        3 MB,  cost 100699.000000 us</span><br><span class="line">Num:  1048576,  Size:        4 MB,  cost 130651.000000 us</span><br><span class="line">Num:  1310720,  Size:        5 MB,  cost 99732.000000 us</span><br><span class="line">Num:  1572864,  Size:        6 MB,  cost 120678.000000 us</span><br><span class="line">Num:  1835008,  Size:        7 MB,  cost 118715.000000 us</span><br><span class="line">Num:  2097152,  Size:        8 MB,  cost 151562.000000 us</span><br><span class="line">Num:  2359296,  Size:        9 MB,  cost 96772.000000 us</span><br><span class="line">Num:  2621440,  Size:       10 MB,  cost 104690.000000 us</span><br><span class="line">Num:  2883584,  Size:       11 MB,  cost 104754.000000 us</span><br><span class="line">Num:  3145728,  Size:       12 MB,  cost 152557.000000 us</span><br><span class="line">Num:  3407872,  Size:       13 MB,  cost 105716.000000 us</span><br><span class="line">Num:  3670016,  Size:       14 MB,  cost 156583.000000 us</span><br><span class="line">Num:  3932160,  Size:       15 MB,  cost 141678.000000 us</span><br></pre></td></tr></table></figure>

<p>我笔记本是 i7 7700HQ，在网上可以查到详细的 Cache 信息</p>
<table>
<thead>
<tr>
<th>Cache:</th>
<th>L1 data</th>
<th>L1 instruction</th>
<th>L2</th>
<th>L3</th>
</tr>
</thead>
<tbody><tr>
<td>Size:</td>
<td>4 x 32 KB</td>
<td>4 x 32 KB</td>
<td>4 x 256 KB</td>
<td>6 MB</td>
</tr>
<tr>
<td>Associativity:</td>
<td>8-way set associative</td>
<td>8-way set associative</td>
<td>4-way set associative</td>
<td>12-way set associative</td>
</tr>
<tr>
<td>Line size:</td>
<td>64 bytes</td>
<td>64 bytes</td>
<td>64 bytes</td>
<td>64 bytes</td>
</tr>
<tr>
<td>Comments:</td>
<td>Direct-mapped</td>
<td>Direct-mapped</td>
<td>Non-inclusive Direct-mapped</td>
<td>Inclusive Shared between all cores</td>
</tr>
</tbody></table>
<p>Cache Line 比较好测，上面的代码中可以明显看到从 64 Bytes 开始，平均访问时间出现跳变。</p>
<p>L1、L2、L3 各自的大小……说实话我觉得这样测效果并不好，变化倒是确实有，就是其中可能还有很多误差成分在。</p>
<p>CSAPP 上面讲 Cache 的那章用的是类似的方法，根据这样的测试结果可以画出一张“存储器山”的图。</p>
<h2 id="多核情况下-Cache-会有什么问题？"><a href="#多核情况下-Cache-会有什么问题？" class="headerlink" title="多核情况下 Cache 会有什么问题？"></a>多核情况下 Cache 会有什么问题？</h2><p>这个问的主要应该就是 Cache 的一致性、写回、写直达等等这些方面的内容。</p>
<p>另外还有一个叫做伪共享（False Sharing）的问题：</p>
<p><img data-src="http://jcf94.com/download/2018-09-04-cache-sbtfalse_sharing.PNG" alt="False Sharing"></p>
<p>多核 CPU 通常都是 L1、L2 每个核独立，共享 L3。如上图这种情况，两个核实际操作的数据是独立的，但是它们恰好在一个 Cache Line 里面，则其中一个作了修改之后，另一个的 Cache Line 也会跟着失效，引起了本来不必要的效率问题。</p>

    </div>

    
    
    
      


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Cache/" rel="tag"># Cache</a>
              <a href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag"># 面试</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/06/20/2018-06-20-lca/" rel="prev" title="理一个 LCA 模版">
      <i class="fa fa-chevron-left"></i> 理一个 LCA 模版
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/09/07/2018-09-07-multithreads/" rel="next" title="多线程相关整理">
      多线程相关整理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Basic"><span class="nav-text">Basic</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Interview-Questions"><span class="nav-text">Interview Questions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟地址-or-物理地址？"><span class="nav-text">虚拟地址 or 物理地址？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#对-Cache-每一级的访存需要多少个-Cycle-有概念吗？"><span class="nav-text">对 Cache 每一级的访存需要多少个 Cycle 有概念吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么需要分级？"><span class="nav-text">为什么需要分级？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组成结构？"><span class="nav-text">组成结构？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何测出一块未知-CPU-的-Cache-参数？"><span class="nav-text">如何测出一块未知 CPU 的 Cache 参数？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多核情况下-Cache-会有什么问题？"><span class="nav-text">多核情况下 Cache 会有什么问题？</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jcf94"
      src="/photo.jpg">
  <p class="site-author-name" itemprop="name">Jcf94</p>
  <div class="site-description" itemprop="description">To live is to change the world.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">163</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jcf94" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jcf94" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/jcf94" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;jcf94" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://www.zhihu.com/people/jcf94" title="Zhihu → http:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;jcf94" rel="noopener" target="_blank"><i class="fa fa-fw fa-book"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.linkedin.com/in/jcf94/en" title="Linked-in → https:&#x2F;&#x2F;cn.linkedin.com&#x2F;in&#x2F;jcf94&#x2F;en" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i>Linked-in</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jcf94</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '53c17a207b0eb9315f41',
      clientSecret: 'e697661132cf0936345a27b937f76074f55002be',
      repo        : 'blog-comments',
      owner       : 'jcf94',
      admin       : ['jcf94'],
      // id          : '5be7cb29f0da4e6038c22129f3f0090b',
      id          : location.pathname,
        language: 'en',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
